<h1><%= @group.title %></h1>

<%= form_tag group_path(@group), :method => :get do %>
  <p>
    Near to
    <%= text_field_tag :search, params[:search], :style => "width: 100px;" %>
    in radius
    <%= text_field_tag :search_range, params[:search_range], :style => "width: 30px;" %>
    <%= submit_tag "Search Near", :name => nil %>
  </p>
<% end %>

<br />

<%= debug(request.location.coordinates) %>


<ul id="markers_list">  </ul>


<a id="show_distances_link" href="javascript:void(0);">Show distances</a>

<%= gmaps("map_options" => {"zoom" => 1, "detect_location" => false, "center_on_user" => true, "auto_adjust" => @adjust || true, "provider_key" => "ABQIAAAApJArxHc7YBf6zd_yKs9-5RQNIUD9-_P9dKRT5ZjrSILxyI7CoBQpHs-Sr82X9HZS53r9gFUHbaSdvg"},
          "markers" => {
                        "data" => @markers.to_gmaps4rails,
                        "options" => {

                                     }
                        }
) %>


<% content_for :scripts do %>
<script type="text/javascript">
Gmaps.map.callback = function() {

   <% @markers.each do |marker| %>
    $("#markers_list").append('<li><a id="marker_link_<%= marker.id.to_s %>" href="javascript:void(0);"><%= marker.name + " - " + @location + " (" + marker.distance_to(@location).round(2).to_s + " miles)" %></a></li>');
    $("#marker_link_<%= marker.id.to_s %>").each(function(){
      this.onclick = function(event) {
        var marker_lat_lng = new google.maps.LatLng(<%= marker.latitude %>, <%= marker.longitude %>);
        Gmaps.map.map.panTo(marker_lat_lng);
      };
    });
   <% end %>



}

</script>
<% end %>

